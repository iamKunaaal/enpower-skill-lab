{% extends 'coordinator/base.html' %}
{% load static %}

{% block title %}My Profile - Program Coordinator{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/coordinator/profile.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="profile-container">
        <div class="page-header">
            <h1>My Profile</h1>
            <p>Manage your personal information and account settings</p>
        </div>

        <div class="profile-grid">
            <!-- Personal Information Card -->
            <div class="profile-card full-width">
                <div class="card-header">
                    <span class="material-symbols-outlined">person</span>
                    <h2>Personal Information</h2>
                </div>

                <form id="profileForm" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <!-- Photo Upload Section -->
                    <div class="photo-section">
                        <div class="profile-photo-wrapper">
                            <div class="profile-photo" id="profilePhotoPreview">
                                {% if user.program_coordinator and user.program_coordinator.profile_photo %}
                                <img src="{{ user.program_coordinator.profile_photo.url }}" alt="{{ user.get_full_name }}">
                                {% else %}
                                <span class="material-symbols-outlined">account_circle</span>
                                {% endif %}
                            </div>
                            <label class="photo-upload-btn" for="profilePhotoInput">
                                <span class="material-symbols-outlined">photo_camera</span>
                            </label>
                            <input type="file" id="profilePhotoInput" name="profile_photo" class="photo-input" accept="image/*">
                        </div>
                        <p class="photo-hint">Upload a profile photo (Max 2MB, JPG, PNG)</p>
                    </div>

                    <!-- Personal Details -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Full Name <span class="required">*</span></label>
                            <input type="text" id="fullName" name="full_name" class="form-input" value="{{ user.program_coordinator.full_name|default:user.get_full_name|default:user.username }}" readonly>
                            <span class="error-message" id="fullNameError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Email Address <span class="required">*</span></label>
                            <input type="email" id="email" name="email" class="form-input" value="{{ user.program_coordinator.official_email|default:user.email }}" readonly>
                            <span class="error-message" id="emailError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phone Number <span class="required">*</span></label>
                            <input type="tel" id="phone" name="mobile_number" class="form-input" value="{{ user.program_coordinator.mobile_number|default:'' }}" readonly>
                            <span class="error-message" id="phoneError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Alternate Phone Number</label>
                            <input type="tel" id="alternatePhone" name="alternate_number" class="form-input" placeholder="Enter alternate phone" value="{{ user.program_coordinator.alternate_number|default:'' }}" readonly>
                            <span class="error-message" id="alternatePhoneError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Gender</label>
                            <select id="gender" name="gender" class="form-select" disabled>
                                <option value="">Select gender</option>
                                <option value="male" {% if user.program_coordinator.gender == 'male' %}selected{% endif %}>Male</option>
                                <option value="female" {% if user.program_coordinator.gender == 'female' %}selected{% endif %}>Female</option>
                                <option value="other" {% if user.program_coordinator.gender == 'other' %}selected{% endif %}>Other</option>
                            </select>
                            <span class="error-message" id="genderError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" id="dateOfBirth" name="date_of_birth" class="form-input" value="{{ user.program_coordinator.date_of_birth|date:'Y-m-d'|default:'' }}" readonly>
                            <span class="error-message" id="dateOfBirthError"></span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancelBtn" style="display: none;">
                            <span class="material-symbols-outlined">close</span>
                            Cancel
                        </button>
                        <button type="button" class="btn btn-edit-profile" id="editBtn">
                            <span class="material-symbols-outlined">edit</span>
                            Edit Profile
                        </button>
                        <button type="submit" class="btn btn-save" id="saveBtn" style="display: none;">
                            <span class="material-symbols-outlined">save</span>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>

            <!-- Role Information Card -->
            <div class="profile-card">
                <div class="card-header">
                    <span class="material-symbols-outlined">admin_panel_settings</span>
                    <h2>Role Information</h2>
                </div>

                <div class="role-info-grid">
                    <div class="info-item full-width">
                        <span class="info-label">Role</span>
                        <div class="role-badge">
                            <span class="material-symbols-outlined">verified</span>
                            Program Coordinator
                        </div>
                    </div>

                    <div class="info-item">
                        <span class="info-label">Account Created On</span>
                        <span class="info-value">{{ user.date_joined|date:"F d, Y" }}</span>
                    </div>

                    <div class="info-item">
                        <span class="info-label">Last Login</span>
                        <span class="info-value">{{ user.last_login|date:"F d, Y g:i A"|default:"Never" }}</span>
                    </div>

                    <div class="info-item full-width" style="margin-top: 12px;">
                        <span class="info-label">Assigned Permissions</span>
                        <div class="permission-badge">
                            <span class="material-symbols-outlined">security</span>
                            Program Management Access
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Security Card -->
            <div class="profile-card">
                <div class="card-header">
                    <span class="material-symbols-outlined">lock</span>
                    <h2>Account Security</h2>
                </div>

                <div class="role-info-grid single-column">
                    <div class="info-item">
                        <span class="info-label">Password</span>
                        <span class="info-value">••••••••••</span>
                    </div>

                    <div class="info-item">
                        <span class="info-label">Last Password Change</span>
                        <span class="info-value">{{ user.program_coordinator.last_password_change|date:"F d, Y"|default:"Never Changed" }}</span>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-edit-profile" onclick="window.location.href='{% url 'coordinator:coordinator_change_password' %}'">
                        <span class="material-symbols-outlined">key</span>
                        Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/coordinator/profile.js' %}"></script>
{% endblock %}
