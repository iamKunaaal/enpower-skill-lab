{% extends 'superadmin/base.html' %}
{% load static %}

{% block title %}Onboard Parent - Enpower Skill Lab{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/onboard-parent.css' %}">
{% endblock %}

{% block content %}
<div class="onboard-parent-page">
    <form class="onboard-parent-form" id="parentForm" method="POST" enctype="multipart/form-data" action="{% url 'onboard_parent' %}">
        {% csrf_token %}
        
        <div id="dummy-data-btn">
            <div class="form-header">
                <h1 class="page-title">Onboard Parent</h1>
                <p class="page-subtitle">Fill in the parent details to onboard them to the system</p>
            </div>
            <div class="dummydata-btn">
                <button type="button" id="autoFillBtn" class="btn-autofill">
                    <span class="material-symbols-outlined">auto_fix_high</span>
                    Auto-Fill with Dummy Data
                </button>
            </div>
        </div>

        <!-- Progress Stepper -->
        <div class="stepper-container">
            <div class="stepper">
                <div class="step active" data-step="1">
                    <div class="step-icon">1</div>
                    <div class="step-label">Primary Parent</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-icon">2</div>
                    <div class="step-label">Student</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-icon">3</div>
                    <div class="step-label">Secondary Parent</div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-icon">4</div>
                    <div class="step-label">Address</div>
                </div>
                <div class="step" data-step="5">
                    <div class="step-icon">5</div>
                    <div class="step-label">Communication</div>
                </div>
                <div class="step" data-step="6">
                    <div class="step-icon">6</div>
                    <div class="step-label">Financial</div>
                </div>
                <div class="step" data-step="7">
                    <div class="step-icon">7</div>
                    <div class="step-label">Emergency</div>
                </div>
                <div class="step" data-step="8">
                    <div class="step-icon">8</div>
                    <div class="step-label">Involvement</div>
                </div>
            </div>
        </div>

        <!-- Step 1: Primary Parent / Guardian Details -->
        <div class="form-section step-content" id="step1">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">person</span>
                    A. Primary Parent / Guardian Details
                </h2>
            </div>

            <div class="form-group full-width">
                <label for="profilePhoto" class="form-label">Parent Photo (Optional)</label>
                <div class="photo-upload-container">
                    <div class="photo-preview" id="photoPreview">
                        <span class="material-symbols-outlined">add_a_photo</span>
                        <span class="photo-preview-text">Upload Photo</span>
                    </div>
                    <input type="file" id="profilePhoto" name="profile_photo" accept="image/*" class="photo-input">
                    <button type="button" class="upload-photo-btn" id="uploadPhotoBtn">
                        <span class="material-symbols-outlined">upload</span>
                        Choose Photo
                    </button>
                    <p class="field-hint">Recommended: Square image, max 2MB</p>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="full_name" class="form-label">Full Name <span class="required">*</span></label>
                    <input type="text" id="full_name" name="full_name" class="form-input" placeholder="Enter full name" required>
                    <span class="error-message" id="full_nameError"></span>
                </div>

                <div class="form-group">
                    <label for="relation_to_student" class="form-label">Relation to Student <span class="required">*</span></label>
                    <select id="relation_to_student" name="relation_to_student" class="form-input" required>
                        <option value="" disabled selected hidden>Select relation</option>
                        <option value="mother">Mother</option>
                        <option value="father">Father</option>
                        <option value="guardian">Guardian</option>
                    </select>
                    <span class="error-message" id="relation_to_studentError"></span>
                </div>

                <div class="form-group">
                    <label for="mobile_number" class="form-label">Mobile Number <span class="required">*</span></label>
                    <input type="tel" id="mobile_number" name="mobile_number" class="form-input" placeholder="10-digit mobile number" required maxlength="10">
                    <span class="error-message" id="mobile_numberError"></span>
                </div>

                <div class="form-group">
                    <label for="alternate_mobile" class="form-label">Alternate Mobile Number</label>
                    <input type="tel" id="alternate_mobile" name="alternate_mobile" class="form-input" placeholder="10-digit mobile number" maxlength="10">
                    <span class="error-message" id="alternate_mobileError"></span>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email ID <span class="required">*</span></label>
                    <input type="email" id="email" name="email" class="form-input" placeholder="parent@example.com" required>
                    <span class="error-message" id="emailError"></span>
                    <p class="field-hint">Used for login</p>
                </div>

                <div class="form-group">
                    <label for="occupation" class="form-label">Occupation</label>
                    <input type="text" id="occupation" name="occupation" class="form-input" placeholder="Enter occupation">
                    <span class="error-message" id="occupationError"></span>
                </div>

                <div class="form-group">
                    <label for="organization" class="form-label">Organization / Company Name</label>
                    <input type="text" id="organization" name="organization" class="form-input" placeholder="Enter company name">
                    <span class="error-message" id="organizationError"></span>
                </div>

                <div class="form-group">
                    <label for="education_level" class="form-label">Education Level</label>
                    <select id="education_level" name="education_level" class="form-input">
                        <option value="" disabled selected hidden>Select education level</option>
                        <option value="high-school">High School</option>
                        <option value="diploma">Diploma</option>
                        <option value="graduate">Graduate</option>
                        <option value="post-graduate">Post Graduate</option>
                        <option value="doctorate">Doctorate</option>
                        <option value="other">Other</option>
                    </select>
                    <span class="error-message" id="education_levelError"></span>
                </div>

                <div class="form-group">
                    <label for="id_proof" class="form-label">ID Proof (Aadhar / PAN - Optional)</label>
                    <input type="text" id="id_proof" name="id_proof" class="form-input" placeholder="Enter Aadhar or PAN number">
                    <span class="error-message" id="id_proofError"></span>
                </div>
            </div>
        </div>

        <!-- Step 2: Student Assignment -->
        <div class="form-section step-content" id="step2" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">school</span>
                    B. Student Assignment
                </h2>
            </div>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="students" class="form-label">Link to Student(s) <span class="required">*</span></label>
                    <select id="students" name="students" class="form-input" multiple required>
                        {% for student in students %}
                        <option value="{{ student.id }}">{{ student.full_name }} - {{ student.student_class }} ({{ student.gr_number }})</option>
                        {% empty %}
                        <option value="" disabled>No students available</option>
                        {% endfor %}
                    </select>
                    <span class="error-message" id="studentsError"></span>
                    <p class="field-hint">Hold Ctrl/Cmd to select multiple students. This links the parent to their child(ren).</p>
                </div>
            </div>
        </div>

        <!-- Step 3: Secondary Parent / Guardian -->
        <div class="form-section step-content" id="step3" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">people</span>
                    C. Secondary Parent / Guardian
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="secondary_full_name" class="form-label">Full Name</label>
                    <input type="text" id="secondary_full_name" name="secondary_full_name" class="form-input" placeholder="Enter full name">
                    <span class="error-message" id="secondary_full_nameError"></span>
                </div>

                <div class="form-group">
                    <label for="secondary_relation" class="form-label">Relation</label>
                    <select id="secondary_relation" name="secondary_relation" class="form-input">
                        <option value="" disabled selected hidden>Select relation</option>
                        <option value="mother">Mother</option>
                        <option value="father">Father</option>
                        <option value="guardian">Guardian</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="uncle">Uncle</option>
                        <option value="aunt">Aunt</option>
                    </select>
                    <span class="error-message" id="secondary_relationError"></span>
                </div>

                <div class="form-group">
                    <label for="secondary_mobile" class="form-label">Mobile Number</label>
                    <input type="tel" id="secondary_mobile" name="secondary_mobile" class="form-input" placeholder="10-digit mobile number" maxlength="10">
                    <span class="error-message" id="secondary_mobileError"></span>
                </div>

                <div class="form-group">
                    <label for="secondary_email" class="form-label">Email ID</label>
                    <input type="email" id="secondary_email" name="secondary_email" class="form-input" placeholder="secondary@example.com">
                    <span class="error-message" id="secondary_emailError"></span>
                </div>

                <div class="form-group">
                    <label for="secondary_occupation" class="form-label">Occupation</label>
                    <input type="text" id="secondary_occupation" name="secondary_occupation" class="form-input" placeholder="Enter occupation">
                    <span class="error-message" id="secondary_occupationError"></span>
                </div>

                <div class="form-group">
                    <label for="preferred_contact" class="form-label">Preferred Contact Person <span class="required">*</span></label>
                    <select id="preferred_contact" name="preferred_contact" class="form-input" required>
                        <option value="" disabled selected hidden>Select preferred contact</option>
                        <option value="primary">Primary Parent/Guardian</option>
                        <option value="secondary">Secondary Parent/Guardian</option>
                        <option value="both">Both</option>
                    </select>
                    <span class="error-message" id="preferred_contactError"></span>
                </div>
            </div>
        </div>

        <!-- Step 4: Contact & Address -->
        <div class="form-section step-content" id="step4" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">home</span>
                    C. Contact & Address
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="residential_address" class="form-label">Residential Address <span class="required">*</span></label>
                    <textarea id="residential_address" name="residential_address" class="form-input form-textarea" placeholder="House No., Street, Area" required rows="3"></textarea>
                    <span class="error-message" id="residential_addressError"></span>
                </div>

                <div class="form-group">
                    <label for="landmark" class="form-label">Landmark</label>
                    <input type="text" id="landmark" name="landmark" class="form-input" placeholder="Near landmark">
                    <span class="error-message" id="landmarkError"></span>
                </div>

                <div class="form-group">
                    <label for="city" class="form-label">City <span class="required">*</span></label>
                    <input type="text" id="city" name="city" class="form-input" placeholder="Enter city" required>
                    <span class="error-message" id="cityError"></span>
                </div>

                <div class="form-group">
                    <label for="state" class="form-label">State <span class="required">*</span></label>
                    <input type="text" id="state" name="state" class="form-input" placeholder="Enter state" required>
                    <span class="error-message" id="stateError"></span>
                </div>

                <div class="form-group">
                    <label for="pin_code" class="form-label">Pin Code <span class="required">*</span></label>
                    <input type="text" id="pin_code" name="pin_code" class="form-input" placeholder="6-digit PIN code" maxlength="6" required>
                    <span class="error-message" id="pin_codeError"></span>
                </div>

                <div class="form-group full-width">
                    <label for="permanent_address" class="form-label">Permanent Address (if different)</label>
                    <textarea id="permanent_address" name="permanent_address" class="form-input form-textarea" placeholder="Enter permanent address if different from residential" rows="3"></textarea>
                    <span class="error-message" id="permanent_addressError"></span>
                </div>
            </div>
        </div>

        <!-- Step 5: Communication Preferences -->
        <div class="form-section step-content" id="step5" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">chat</span>
                    D. Communication Preferences
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="contact_method" class="form-label">Preferred Contact Method <span class="required">*</span></label>
                    <select id="contact_method" name="contact_method" class="form-input" required>
                        <option value="" disabled selected hidden>Select contact method</option>
                        <option value="call">Phone Call</option>
                        <option value="whatsapp">WhatsApp</option>
                        <option value="sms">SMS</option>
                        <option value="email">Email</option>
                    </select>
                    <span class="error-message" id="contact_methodError"></span>
                </div>

                <div class="form-group">
                    <label for="preferred_language" class="form-label">Preferred Language <span class="required">*</span></label>
                    <select id="preferred_language" name="preferred_language" class="form-input" required>
                        <option value="" disabled selected hidden>Select language</option>
                        <option value="english">English</option>
                        <option value="hindi">Hindi</option>
                        <option value="marathi">Marathi</option>
                        <option value="gujarati">Gujarati</option>
                        <option value="tamil">Tamil</option>
                        <option value="telugu">Telugu</option>
                        <option value="kannada">Kannada</option>
                        <option value="other">Other</option>
                    </select>
                    <span class="error-message" id="preferred_languageError"></span>
                </div>

                <div class="form-group">
                    <label for="dnd_timings" class="form-label">Do Not Disturb Timings (Optional)</label>
                    <input type="text" id="dnd_timings" name="dnd_timings" class="form-input" placeholder="e.g., 10:00 PM - 7:00 AM">
                    <span class="error-message" id="dnd_timingsError"></span>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">Consent for WhatsApp Communications</label>
                    <div class="radio-options">
                        <div class="radio-option">
                            <input type="radio" id="whatsappYes" name="whatsapp_consent" value="yes">
                            <label for="whatsappYes">Yes, I consent</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="whatsappNo" name="whatsapp_consent" value="no">
                            <label for="whatsappNo">No, I do not consent</label>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">Consent for Sharing Child Photos</label>
                    <div class="radio-options">
                        <div class="radio-option">
                            <input type="radio" id="photoConsentYes" name="photo_consent" value="yes">
                            <label for="photoConsentYes">Yes, I consent</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="photoConsentNo" name="photo_consent" value="no">
                            <label for="photoConsentNo">No, I do not consent</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 6: Financial & Administrative -->
        <div class="form-section step-content" id="step6" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">payments</span>
                    E. Financial & Administrative
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="fee_category" class="form-label">Fee Category <span class="required">*</span></label>
                    <select id="fee_category" name="fee_category" class="form-input" required>
                        <option value="" disabled selected hidden>Select fee category</option>
                        <option value="regular">Regular</option>
                        <option value="scholarship">Scholarship</option>
                        <option value="concession">Concession</option>
                    </select>
                    <span class="error-message" id="fee_categoryError"></span>
                </div>

                <div class="form-group">
                    <label for="payment_mode" class="form-label">Payment Mode Preference</label>
                    <select id="payment_mode" name="payment_mode" class="form-input">
                        <option value="" disabled selected hidden>Select payment mode</option>
                        <option value="online">Online Payment</option>
                        <option value="bank-transfer">Bank Transfer</option>
                        <option value="cheque">Cheque</option>
                        <option value="cash">Cash</option>
                        <option value="upi">UPI</option>
                    </select>
                    <span class="error-message" id="payment_modeError"></span>
                </div>

                <div class="form-group">
                    <label for="billing_email" class="form-label">Billing Email</label>
                    <input type="email" id="billing_email" name="billing_email" class="form-input" placeholder="billing@example.com">
                    <span class="error-message" id="billing_emailError"></span>
                    <p class="field-hint">Leave blank to use primary email</p>
                </div>

                <div class="form-group">
                    <label for="gst_number" class="form-label">GST Number (if corporate billing)</label>
                    <input type="text" id="gst_number" name="gst_number" class="form-input" placeholder="e.g., 22AAAAA0000A1Z5">
                    <span class="error-message" id="gst_numberError"></span>
                </div>
            </div>
        </div>

        <!-- Step 7: Emergency Contacts -->
        <div class="form-section step-content" id="step7" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">emergency</span>
                    F. Emergency Contacts (If parents unavailable)
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="emergency_name" class="form-label">Contact Name <span class="required">*</span></label>
                    <input type="text" id="emergency_name" name="emergency_name" class="form-input" placeholder="Enter emergency contact name" required>
                    <span class="error-message" id="emergency_nameError"></span>
                </div>

                <div class="form-group">
                    <label for="emergency_relation" class="form-label">Relation <span class="required">*</span></label>
                    <select id="emergency_relation" name="emergency_relation" class="form-input" required>
                        <option value="" disabled selected hidden>Select relation</option>
                        <option value="grandparent">Grandparent</option>
                        <option value="uncle">Uncle</option>
                        <option value="aunt">Aunt</option>
                        <option value="sibling">Sibling</option>
                        <option value="neighbor">Neighbor</option>
                        <option value="family-friend">Family Friend</option>
                        <option value="other">Other</option>
                    </select>
                    <span class="error-message" id="emergency_relationError"></span>
                </div>

                <div class="form-group">
                    <label for="emergency_phone" class="form-label">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="emergency_phone" name="emergency_phone" class="form-input" placeholder="10-digit mobile number" required maxlength="10">
                    <span class="error-message" id="emergency_phoneError"></span>
                </div>

                <div class="form-group full-width">
                    <label for="emergency_address" class="form-label">Address</label>
                    <textarea id="emergency_address" name="emergency_address" class="form-input form-textarea" placeholder="Enter emergency contact address" rows="3"></textarea>
                    <span class="error-message" id="emergency_addressError"></span>
                </div>
            </div>
        </div>

        <!-- Step 8: Parent Involvement -->
        <div class="form-section step-content" id="step8" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="material-symbols-outlined">volunteer_activism</span>
                    G. Parent Involvement
                </h2>
            </div>

            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="meeting_availability" class="form-label">Availability for Monthly Meeting</label>
                    <select id="meeting_availability" name="meeting_availability" class="form-input">
                        <option value="" disabled selected hidden>Select availability</option>
                        <option value="online">Online Only</option>
                        <option value="offline">Offline Only</option>
                        <option value="both">Both Online and Offline</option>
                        <option value="not-available">Not Available</option>
                    </select>
                    <span class="error-message" id="meeting_availabilityError"></span>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">Volunteer Interest (Events, Workshops)</label>
                    <div class="radio-options">
                        <div class="radio-option">
                            <input type="radio" id="volunteerYes" name="volunteer_interest" value="yes">
                            <label for="volunteerYes">Yes, I'm interested</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="volunteerNo" name="volunteer_interest" value="no">
                            <label for="volunteerNo">No, not at this time</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="volunteerMaybe" name="volunteer_interest" value="maybe">
                            <label for="volunteerMaybe">Maybe, contact me later</label>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="parent_skills" class="form-label">Parent Skills (Useful for School / Lab activities)</label>
                    <textarea id="parent_skills" name="parent_skills" class="form-input form-textarea" placeholder="e.g., Public Speaking, Art, Music, Technology, Sports Coaching" rows="3"></textarea>
                    <span class="error-message" id="parent_skillsError"></span>
                    <p class="field-hint">List any skills you can contribute to school activities</p>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="button" class="btn-back" id="backBtn" style="display: none;">
                <span class="material-symbols-outlined">arrow_back</span>
                Back
            </button>
            <div class="action-buttons-right">
                <button type="button" class="btn-next" id="nextBtn">
                    Next
                    <span class="material-symbols-outlined">arrow_forward</span>
                </button>
                <button type="submit" class="btn-submit" id="submitBtn" style="display: none;">
                    <span class="material-symbols-outlined">check</span>
                    Submit
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/onboard-parent.js' %}"></script>
{% endblock %}
