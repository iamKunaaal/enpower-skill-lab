{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENpower - Sign In</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <style>
        body { font-family: "Poppins", sans-serif; background: #f8f9ff; }
        .left-section { background: url("{% static 'assets/images/form image.png' %}") no-repeat center; background-size: cover; min-height: 100vh; width: 50%; }
        .right-section { width: 50%; }
        .form-container { max-width: 420px; margin: auto; }
        .input-wrapper { position: relative; }
        .input-wrapper iconify-icon { position: absolute; left: 15px; top: 50%; font-size: 20px; transform: translateY(-50%); color: #7b7b7b; }
        .main-head { font-weight: 500 !important; }
        .form-control { height: 52px; border-radius: 12px; padding-left: 45px; background: #f2f2f7; border: 1px solid #e0e0e0; }
        .form-control.error { border-color: red !important; }
        .error-text { color: red; font-size: 13px; margin-top: 5px; }
        .toggle-eye { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 20px; cursor: pointer; color: #7b7b7b; }
        .btn-primary { height: 52px; border-radius: 12px; background: #6b30ee; border: none; }
        .btn-primary:hover { background: #5b25db; }
        .social-btn { border: 1px solid #dedede; border-radius: 12px; padding: 12px 16px; width: 48%; background: white; }
        .divider { text-align: center; margin: 25px 0; position: relative; }
        .divider:before, .divider:after { content: ""; width: 35%; height: 1px; background: #d9d9d9; position: absolute; top: 50%; }
        .divider:before { left: 0; }
        .divider:after { right: 0; }
        .d-flex.justify-content-between.mb-3.fp-con { margin-top: 2rem; }
        a.text-primary.fw-semibold.fg-text, a.text-primary.fw-semibold.su-text { text-decoration: none; color: rgb(198, 128, 236) !important; font-weight: 500 !important; }
        .su-text-p { margin-top: 3rem !important; }
        #googleBtn div { border-radius: 12px !important; height: 52px !important; }
        .nsm7Bb-HzV7m-LgbsSe-Bz112c { display: flex; }
        .login-button { flex-direction: row; justify-content: center; align-items: center; }
        @media (max-width: 991px) {
            .left-section { display: none !important; }
            .right-section { width: 100% !important; padding: 40px 20px !important; margin-top: 30px; }
            .form-container { max-width: 100% !important; width: 100%; }
            .social-btn { width: 100% !important; }
            #googleBtn { width: 100% !important; }
            .login-button { flex-direction: column; gap: 12px; }
            .si-text { margin-top: 10px; }
        }
        @media (max-width: 576px) {
            body { padding: 0 !important; }
            .right-section { padding: 30px 15px !important; margin-top: 40px; }
            .form-control { height: 48px !important; padding-left: 42px !important; }
            .toggle-eye { right: 12px !important; }
            .divider:before, .divider:after { width: 28% !important; }
            .social-btn { padding: 10px 12px !important; }
            .main-head { font-size: 22px !important; }
            p.text-muted { font-size: 14px !important; }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-7 d-none d-lg-block left-section"></div>
            <div class="col-lg-5 d-flex align-items-center p-5 right-section">
                <div class="form-container w-100">
                    <img src="{% static 'assets/images/enpower-logo (1).png' %}" width="160" class="mb-4" alt="ENpower logo">
                    <h3 class="fw-bold mb-2 main-head">Sign In to your Account</h3>
                    <p class="text-muted mb-4">Welcome back! Please enter your details</p>
                    {% if messages %}
                        <div class="mb-3">
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} mb-2" role="alert">{{ message }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <form id="signinForm" method="post" action="{% url 'login' %}" novalidate>
                        {% csrf_token %}
                        <div class="mb-3 input-wrapper position-relative">
                            <iconify-icon icon="mdi:account-circle-outline"></iconify-icon>
                            <select class="form-control" id="role" name="role" style="appearance: none; padding-right: 40px;" required>
                                <option value="" disabled selected>Select Your Role</option>
                                <option value="STUDENT">Student</option>
                                <option value="PARENT">Parent</option>
                                <option value="THINKING_COACH">Thinking Coach</option>
                                <option value="SCHOOL_ADMIN">School Admin</option>
                                <option value="PROGRAM_COORDINATOR">Program Coordinator</option>
                                <option value="SUPER_ADMIN">Super Admin</option>
                            </select>
                            <span class="bi bi-chevron-down" style="position:absolute; right:15px; top:50%; transform:translateY(-50%); pointer-events:none; color:#7b7b7b; font-size:16px;"></span>
                            <div class="error-text" id="roleError"></div>
                        </div>
                        <div class="mb-3 input-wrapper">
                            <iconify-icon icon="mdi:email-outline"></iconify-icon>
                            <input type="text" class="form-control" id="username" name="username" placeholder="Username or email" required>
                            <div class="error-text" id="emailError"></div>
                        </div>
                        <div class="mb-3 input-wrapper position-relative">
                            <iconify-icon icon="mdi:lock-outline"></iconify-icon>
                            <input type="password" class="form-control" id="password" name="password" placeholder="Password" required>
                            <i class="bi bi-eye toggle-eye" id="togglePassword"></i>
                            <div class="error-text" id="passwordError"></div>
                        </div>
                        <div class="d-flex justify-content-between mb-3 fp-con">
                            <div>
                                <input type="checkbox" id="remember">
                                <label for="remember" class="ms-1">Remember me</label>
                            </div>
                            <a href="#" class="text-primary fw-semibold fg-text">Forgot Password?</a>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 si-text">Sign In</button>
                        {% comment %} <div class="divider">Or sign in with</div>
                        <div class="d-flex gap-2 login-button">
                            <button type="button" class="social-btn d-flex align-items-center justify-content-center">
                                <img width="20" src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="Facebook logo">
                                <span class="ms-2">Facebook</span>
                            </button>
                            <div id="googleBtn" style="width: 50%;"></div>
                        </div>
                        <p class="text-center mt-4 su-text-p">
                            Don't have an account?
                            <a href="#" class="text-primary fw-semibold su-text">Sign Up</a>
                        </p> {% endcomment %}
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        const form = document.getElementById("signinForm");
        form.addEventListener("submit", function (e) {
            let valid = true;
            const role = document.getElementById("role");
            const username = document.getElementById("username");
            const password = document.getElementById("password");
            const roleError = document.getElementById("roleError");
            const emailError = document.getElementById("emailError");
            const passwordError = document.getElementById("passwordError");
            roleError.textContent = "";
            emailError.textContent = "";
            passwordError.textContent = "";
            role.classList.remove("error");
            username.classList.remove("error");
            password.classList.remove("error");
            if (role.value === "") { roleError.textContent = "Please select your role"; role.classList.add("error"); valid = false; }
            if (username.value.trim() === "") { emailError.textContent = "Username is required"; username.classList.add("error"); valid = false; }
            if (password.value.trim() === "") { passwordError.textContent = "Password is required"; password.classList.add("error"); valid = false; }
            if (!valid) { e.preventDefault(); }
        });
        document.getElementById("togglePassword").addEventListener("click", function () {
            const pass = document.getElementById("password");
            const type = pass.type === "password" ? "text" : "password";
            pass.type = type;
            this.classList.toggle("bi-eye");
            this.classList.toggle("bi-eye-slash");
        });
        window.onload = function () {
            if (window.google && google.accounts && google.accounts.id) {
                google.accounts.id.initialize({
                    client_id: "268530584126-ma6bqcqq25suer37mu1qv8qepu8a96ul.apps.googleusercontent.com",
                    callback: handleCredentialResponse
                });
                google.accounts.id.renderButton(
                    document.getElementById("googleBtn"),
                    { theme: "outline", size: "large", width: "100%" }
                );
            }
        };
        function handleCredentialResponse(response) {
            console.log("Google Token", response.credential);
        }
    </script>
</body>
</html>
