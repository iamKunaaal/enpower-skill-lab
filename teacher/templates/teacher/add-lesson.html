{% extends 'teacher/base.html' %}
{% load static %}

{% block title %}Create Lesson - Thinking Coach{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/add-lessons.css' %}">
{% endblock %}

{% block content %}
<div class="al-dashboard-page">
    <main class="container-xl py-4 px-4" style="max-width: 1600px;">
        <!-- Page Header -->
        <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-4">
            <div>
                <h1 class="al-page-title">Create Lesson</h1>
                <p class="al-page-subtitle mb-0">Lessons are used for competency-based self-learning content.</p>
            </div>
            <button type="button" class="al-btn-outline" id="alAutoFillBtn" style="gap: 0.5rem;">
                <span class="material-symbols-outlined" style="font-size: 18px;">auto_fix_high</span>
                Auto Fill
            </button>
        </div>

        <!-- Messages -->
        {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <form id="alLessonForm" method="POST" action="{% url 'teacher:add_lesson' %}" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Main Content Grid -->
            <div class="row g-4">
                <!-- Left Column (Main Content) -->
                <div class="col-lg-8">
                    <!-- Basic Details Card -->
                    <div class="al-card-box">
                        <h5 class="fw-bold mb-4">Basic Details</h5>

                        <div class="mb-4">
                            <label for="alLessonTitle" class="al-form-label">Lesson Title <span class="al-required">*</span></label>
                            <input type="text" class="al-form-control" id="alLessonTitle" name="title" placeholder="e.g. Introduction to Financial Literacy" required>
                        </div>

                        <div class="mb-4">
                            <label for="alShortDescription" class="al-form-label">Short Description</label>
                            <textarea class="al-form-control al-textarea" id="alShortDescription" name="description" rows="3" placeholder="Briefly describe what the student will learn..."></textarea>
                        </div>

                        <div>
                            <label class="al-form-label mb-2">Thumbnail</label>
                            <div class="al-upload-box" id="alThumbnailUpload">
                                <div class="al-file-upload-icon">
                                    <span class="material-symbols-outlined">add_photo_alternate</span>
                                </div>
                                <p class="mb-0 fw-medium">Click to upload or drag & drop</p>
                                <small class="text-muted">SVG, PNG, JPG (800Ã—400)</small>
                            </div>
                            <input type="file" id="alThumbnailInput" name="thumbnail" accept="image/*" style="display: none;">
                        </div>
                    </div>

                    <!-- Learning Content Card -->
                    <div class="al-card-box">
                        <h5 class="fw-bold mb-4">Learning Content</h5>

                        <!-- Content Type Tabs -->
                        <input type="hidden" id="alPrimaryContentType" name="primary_content_type" value="video">
                        <textarea id="alArticleContentInput" name="article_content" style="display:none;"></textarea>
                        <textarea id="alVideoUrlsInput" name="video_urls" style="display:none;"></textarea>
                        <textarea id="alQuizDataInput" name="quiz_data" style="display:none;"></textarea>
                        <div class="al-lesson-tabs">
                            <button type="button" class="active" data-content-type="video">
                                <span class="material-symbols-outlined">play_circle</span>
                                Video
                            </button>
                            <button type="button" data-content-type="article">
                                <span class="material-symbols-outlined">article</span>
                                Article
                            </button>
                            <button type="button" data-content-type="quiz">
                                <span class="material-symbols-outlined">quiz</span>
                                Quiz
                            </button>
                            <button type="button" data-content-type="mixed">
                                <span class="material-symbols-outlined">upload_file</span>
                                Resources
                            </button>
                        </div>

                        <!-- Content Area -->
                        <div id="alContentArea"></div>
                    </div>
                </div>

                <!-- Right Column (Sidebar) -->
                <div class="col-lg-4">
                    <!-- Action Buttons Card -->
                    <div class="al-card-box">
                        <button type="button" class="al-btn-primary w-100 mb-3" id="alPublishBtn">
                            <span class="material-symbols-outlined" style="font-size: 1.125rem;">publish</span>
                            Publish Lesson
                        </button>
                        <div class="row g-3">
                            <div class="col-6">
                                <button type="button" class="al-btn-outline w-100" id="alSaveDraftBtn">
                                    Save Draft
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="al-btn-ghost w-100" id="alCancelBtn">
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Assignment Card -->
                    <div class="al-card-box">
                        <h5 class="fw-bold mb-4 d-flex align-items-center gap-2">
                            <span class="material-symbols-outlined">school</span>
                            Assignment
                        </h5>

                        <div class="mb-3">
                            <label for="alCompetency" class="al-form-label">Competency</label>
                            <input type="text" class="al-form-control" id="alCompetency" name="competency" placeholder="Enter competency (e.g., Financial Literacy)">
                        </div>

                        <div class="mb-3">
                            <label for="alLevel" class="al-form-label">Level</label>
                            <select class="al-form-select" id="alLevel" name="level">
                                <option value="">Select Difficulty</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>

                        <div>
                            <label for="alModule" class="al-form-label">Module / Category</label>
                            <input type="text" class="al-form-control" id="alModule" name="module" placeholder="Enter module (e.g., Module 1: Basics)">
                        </div>
                    </div>

                    <!-- Lesson Context Card -->
                    <div class="al-card-box">
                        <h5 class="fw-bold mb-1 d-flex align-items-center gap-2">
                            <span class="material-symbols-outlined">groups</span>
                            Lesson Context
                        </h5>
                        <p class="al-text-xs text-muted mb-4">
                            Define where this lesson will be used.
                        </p>

                        <!-- Applicable Grades -->
                        <div class="mb-4">
                            <label class="al-form-label">
                                Applicable Grade(s) <span class="al-required">*</span>
                            </label>
                            <select class="al-form-select" id="alApplicableGrades" name="applicable_grades">
                                <option value="">Select Grade</option>
                                <option value="8">Standard 8</option>
                                <option value="9">Standard 9</option>
                                <option value="10">Standard 10</option>
                                <option value="11">Standard 11</option>
                                <option value="12">Standard 12</option>
                            </select>
                            <small class="text-muted">
                                Select which grade this lesson applies to.
                            </small>
                        </div>
                    </div>

                    <!-- Visibility Card -->
                    <div class="al-card-box">
                        <h5 class="fw-bold mb-3 d-flex align-items-center gap-2">
                            <span class="material-symbols-outlined">visibility</span>
                            Visibility
                        </h5>

                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <p class="al-text-sm fw-medium mb-1">
                                    Status
                                </p>
                                <p class="al-text-xs text-muted mb-0">Draft or Published</p>
                            </div>
                            <div class="al-switch" id="alStatusToggle" data-field="is_published"></div>
                            <input type="hidden" name="is_published" id="alIsPublished" value="false">
                        </div>

                        <hr style="border-color: #F3F4F6;">

                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="al-text-sm fw-medium mb-1">
                                    Recommend for Low Competency
                                </p>
                                <p class="al-text-xs text-muted mb-0">Suggest to struggling students</p>
                            </div>
                            <div class="al-switch" id="alRecToggle" data-field="recommend_low_competency"></div>
                            <input type="hidden" name="recommend_low_competency" id="alRecommendLow" value="false">
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/add-lessons.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set active menu item
        const navLessons = document.getElementById('nav-lessons');
        if (navLessons) {
            navLessons.classList.add('active');
            const parentDropdown = navLessons.closest('.sidebar-dropdown');
            if (parentDropdown) {
                parentDropdown.classList.add('active');
            }
        }
    });
</script>
{% endblock %}
